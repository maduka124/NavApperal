(function(n){"use strict";typeof define=="function"&&define.amd?define(["jquery","jquery-ui/menu"],n):n(jQuery)})(function(n){"use strict";var u="onselectstart"in document.createElement("div"),i=n.ui.menu.version.match(/^(\d)\.(\d+)/),r={major:parseInt(i[1],10),minor:parseInt(i[2],10)},t=r.major<2&&r.minor<11;n.widget("moogle.contextmenu",{version:"@VERSION",options:{addClass:"ui-contextmenu",autoFocus:!1,autoTrigger:!0,delegate:null,hide:{effect:"fadeOut",duration:"fast"},ignoreParentSelect:!0,menu:null,position:null,preventContextMenuForPopup:!1,preventSelect:!1,show:{effect:"slideDown",duration:"fast"},taphold:!1,uiMenuOptions:{},beforeOpen:n.noop,blur:n.noop,close:n.noop,create:n.noop,createMenu:n.noop,focus:n.noop,open:n.noop,select:n.noop},_create:function(){var i,r,f,t=this.options;if(this.$headStyle=null,this.$menu=null,this.menuIsTemp=!1,this.currentTarget=null,this.previousFocus=null,t.preventSelect){f=(n(this.element).is(document)?n("body"):this.element).uniqueId().attr("id");i="#"+f+" "+t.delegate+" { -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; }";this.$headStyle=n("<style class='moogle-contextmenu-style' />").prop("type","text/css").appendTo("head");try{this.$headStyle.html(i)}catch(e){this.$headStyle[0].styleSheet.cssText=i}u&&this.element.delegate(t.delegate,"selectstart"+this.eventNamespace,function(n){n.preventDefault()})}this._createUiMenu(t.menu);r="contextmenu"+this.eventNamespace;t.taphold&&(r+=" taphold"+this.eventNamespace);this.element.delegate(t.delegate,r,n.proxy(this._openMenu,this))},_destroy:function(){this.element.undelegate(this.eventNamespace);this._createUiMenu(null);this.$headStyle&&(this.$headStyle.remove(),this.$headStyle=null)},_createUiMenu:function(t){var r,i=this.options;if(this.isOpen()&&(r=this.currentTarget,this._closeMenu(!0),this.currentTarget=r),this.menuIsTemp?this.$menu.remove():this.$menu&&this.$menu.menu("destroy").removeClass(this.options.addClass).hide(),this.$menu=null,this.menuIsTemp=!1,t)n.isArray(t)?(this.$menu=n.moogle.contextmenu.createMenuMarkup(t),this.menuIsTemp=!0):this.$menu=typeof t=="string"?n(t):t;else return;this.$menu.hide().addClass(i.addClass).menu(n.extend(!0,{},i.uiMenuOptions,{blur:n.proxy(i.blur,this),create:n.proxy(i.createMenu,this),focus:n.proxy(i.focus,this),select:n.proxy(function(t,r){var u,e=n.moogle.contextmenu.isMenu(r.item),f=r.item.data("actionHandler");r.cmd=r.item.attr("data-command");r.target=n(this.currentTarget);e&&i.ignoreParentSelect||(u=this._trigger.call(this,"select",t,r),f&&(u=f.call(this,t,r)),u!==!1&&this._closeMenu.call(this),t.preventDefault())},this)}))},_openMenu:function(t,i){var s,o,e=this.options,f=e.position,u=this,h=!!t.isTrigger,r={menu:this.$menu,target:n(t.target),extraData:t.extraData,originalEvent:t,result:null};if(e.autoTrigger||h){if(t.preventDefault(),this.currentTarget=t.target,!i){if(s=this._trigger("beforeOpen",t,r),o=r.result&&n.isFunction(r.result.promise)?r.result:null,r.result=null,s===!1)return this.currentTarget=null,!1;if(o)return o.done(function(){u._openMenu(t,!0)}),this.currentTarget=null,!1;r.menu=this.$menu}n(document).bind("keydown"+this.eventNamespace,function(t){t.which===n.ui.keyCode.ESCAPE&&u._closeMenu()}).bind("mousedown"+this.eventNamespace+" touchstart"+this.eventNamespace,function(t){n(t.target).closest(".ui-menu-item").length||u._closeMenu()});n.isFunction(f)&&(f=f(t,r));f=n.extend({my:"left top",at:"left bottom",of:t.pageX===undefined?t.target:t,collision:"fit"},f);this.$menu.show().css({position:"absolute",left:0,top:0}).position(f).hide();e.preventContextMenuForPopup&&this.$menu.bind("contextmenu"+this.eventNamespace,function(n){n.preventDefault()});this._show(this.$menu,e.show,function(){e.autoFocus&&(u.$menu.focus(),u.previousFocus=n(t.target));u._trigger.call(u,"open",t,r)})}},_closeMenu:function(t){var i=this,r=t?!1:this.options.hide;n(document).unbind("mousedown"+this.eventNamespace).unbind("touchstart"+this.eventNamespace).unbind("keydown"+this.eventNamespace);i.currentTarget=null;this.$menu?(this.$menu.unbind("contextmenu"+this.eventNamespace),this._hide(this.$menu,r,function(){i.previousFocus&&(i.previousFocus.focus(),i.previousFocus=null);i._trigger("close")})):i._trigger("close")},_setOption:function(t,i){switch(t){case"menu":this.replaceMenu(i)}n.Widget.prototype._setOption.apply(this,arguments)},_getMenuEntry:function(n){return this.$menu.find("li[data-command="+n+"]")},close:function(){this.isOpen()&&this._closeMenu()},enableEntry:function(n,t){this._getMenuEntry(n).toggleClass("ui-state-disabled",t===!1)},getMenu:function(){return this.$menu},isOpen:function(){return!!this.$menu&&!!this.currentTarget},open:function(n,t){t=t||{};var i=jQuery.Event("contextmenu",{target:n.get(0),extraData:t});return this.element.trigger(i)},replaceMenu:function(n){this._createUiMenu(n)},setEntry:function(t,i){var u,r=this._getMenuEntry(t);typeof i=="string"?n.moogle.contextmenu.updateTitle(r,i):(r.empty(),i.cmd=i.cmd||t,n.moogle.contextmenu.createEntryMarkup(i,r),n.isArray(i.children)&&(u=n("<ul/>").appendTo(r),n.moogle.contextmenu.createMenuMarkup(i.children,u)),this.getMenu().menu("refresh"))},showEntry:function(n,t){this._getMenuEntry(n).toggle(t!==!1)}});n.extend(n.moogle.contextmenu,{createEntryMarkup:function(i,r){var u=null;r.attr("data-command",i.cmd);/[^\-\u2014\u2013\s]/.test(i.title)?(t?(u=n("<a/>",{html:""+i.title,href:"#"}).appendTo(r),i.uiIcon&&u.append(n("<span class='ui-icon' />").addClass(i.uiIcon))):(r.html(""+i.title),n.isFunction(i.action)&&r.data("actionHandler",i.action),i.uiIcon&&r.append(n("<span class='ui-icon' />").addClass(i.uiIcon))),n.isFunction(i.action)&&r.data("actionHandler",i.action),i.disabled&&r.addClass("ui-state-disabled"),i.addClass&&r.addClass(i.addClass),n.isPlainObject(i.data)&&r.data(i.data),i.tooltip!=null&&r.attr("title",i.tooltip)):r.text(i.title)},createMenuMarkup:function(t,i){var r,u,e,f;for(i==null&&(i=n("<ul class='ui-helper-hidden' />").appendTo("body")),r=0;r<t.length;r++)u=t[r],f=n("<li/>").appendTo(i),n.moogle.contextmenu.createEntryMarkup(u,f),n.isArray(u.children)&&(e=n("<ul/>").appendTo(f),n.moogle.contextmenu.createMenuMarkup(u.children,e));return i},isMenu:function(n){return t?n.has(">a[aria-haspopup='true']").length>0:n.is("[aria-haspopup='true']")},replaceFirstTextNodeChild:function(n,t){n.contents().filter(function(){return this.nodeType===3}).first().replaceWith(t)},updateTitle:function(i,r){t?n.moogle.contextmenu.replaceFirstTextNodeChild(n("a",i),r):n.moogle.contextmenu.replaceFirstTextNodeChild(i,r)}})});
/*
//# sourceMappingURL=jquery.ui-contextmenu.min.js.map
*/